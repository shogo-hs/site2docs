# AGENTS

## 目的
このリポジトリで作業するエージェント全員が、共通の背景知識・期待値・安全基準を共有し、最短経路で成果を出すことを目的とします。

## 期待する基本姿勢
- 目的・成果物・制約条件を常に明確化し、曖昧な点は作業前に確認してください。
- 最小限のステップで仮説検証を行い、途中で詰まった場合は早めに状況共有または相談してください。
- 指示やコマンドは、実行前に根拠を説明できる状態で選択してください。
- ローカルでしか再現できない情報（パス、環境変数など）は、最終コメントに必ず明記してください。

### Do
- 既存実装を読んで責務境界を把握した上で差分を作成する。
- 変更点に対して根拠と検証方法を併記する。
- 安全性に影響する操作（削除・外部通信など）は事前に意図を共有する。

### Don't
- 推測に依存した変更や、一貫性のないドキュメント更新を行わない。
- 必要な検証を省略したまま成果物を提出しない。
- 既存の設計意図を読み飛ばしたままモジュール責務を混在させない。

## プロジェクト概要
- Python で実装された静的ナレッジベース生成ツールです。
- 依存関係管理には [`uv`](https://github.com/astral-sh/uv) を必ず使用してください。
- 対応 Python バージョンは `>=3.11` です（`site2docs/pyproject.toml` を参照）。
- 実装コードは `site2docs/src/site2docs` 配下にまとまっています。CLI エントリポイントは `site2docs/cli.py` です。
- 主要依存ライブラリ: Playwright、Readability、Trafilatura、NetworkX、scikit-learn など。用途に応じて追加のブラウザインストールが必要になる場合があります。

### ディレクトリの目安
- `site2docs/src/site2docs/` : アプリケーション本体（構成・レンダリング・CLI 等）。
- `site2docs/pyproject.toml` : パッケージ設定と依存関係。
- `codex_spec_static_doc_generation.md` : 背景仕様（仕様確認用）。

## 環境セットアップと利用コマンド
1. 依存性同期: `uv sync`
2. 任意のコマンド実行: `uv run <python or cli command>`
   - 例: `uv run site2docs --help`
3. Playwright を使用する機能を触る場合は、必要に応じて `uv run playwright install` を実行してください。

## 作業プロセス
1. 要求の理解: タスクのゴール、入力、制約、検証方法を明文化する。
2. インパクト確認: 既存コードや仕様を読み、タッチするモジュールと影響範囲を把握する。
3. 変更計画: 可能な限り小さなステップに分解し、作業計画（Plan）を更新する。
4. 実装・検証: 各ステップごとに動作確認を行い、結果をログとして残す。
5. 最終報告: 実施内容・確認コマンド・検証結果・残課題を簡潔にまとめる。

## コーディング方針
1. **言語ポリシー**
   - ドキュメント、コメント、docstring、CLI ヘルプは原則として日本語で記述してください。
2. **構成の意識**
   - 既存のモジュール分割（例: `config.py`、`rendering.py`）の責務境界を尊重し、役割が混在しないようにしてください。
   - 新しいユーティリティを追加する場合は再利用性と責務の明確化を確認し、既存モジュールとの整合性を取ってください。
3. **型ヒント**
   - 公開関数・メソッドには型ヒントを付与してください。内部ユーティリティでも型が明確な場合は積極的に追加してください。
4. **例外処理**
   - 捕捉する例外は具体的なクラスを指定し、原因調査につながるメッセージを付与してください。
   - CLI からのユーザー向けエラーは、対処方法を併記できる場合は併記してください。
5. **ロギングと可観測性**
   - ログを追加する際は、過剰出力にならないようレベルを調整し、ユーザーが次に取るべき行動が読み取れるメッセージを目指してください。

## テストと検証
- Python コードに変更が及ぶ場合は、最低限 `uv run site2docs --help` が成功することを確認してください。
- 振る舞いに影響する変更を行った場合は、再現手順と期待結果を説明したうえで `uv run pytest` などのテストコマンドを実行してください。
- 追加の検証（例: `uv run site2docs <サンプル入力>`) を行った場合は、使用した引数と結果を報告してください。
- 実行ログやテスト出力を最終コメントに記載する際は、成功・失敗が判別できるように明示してください。

## ドキュメント整備
- README やリファレンスを更新した場合は、変更内容を日本語で要約し、追加したコマンドが再現可能であることを確認してください。
- 図表やコードブロックを追加する際は Markdown の構文を統一し、必要に応じて実行前提（Python バージョン、依存コマンドなど）を補足してください。
- CLI の利用例を追加する場合は、入力と出力の双方に対して前提条件を明記してください。

## コミュニケーションとレポート
- 途中経過の共有では、着手済みステップと未着手ステップを分けて報告してください。
- ブロッカーが発生した場合は、原因・試した解決策・必要な判断を列挙して相談してください。
- 最終コメントは以下の構成を基本とします:
  1. 実施した作業内容（箇条書き）
  2. 実行したコマンドと結果（成功・失敗を明記）
  3. 残課題・フォローアップ事項

## PR メッセージ
- PR のサマリーには主要な機能追加・修正点を箇条書きで記載してください。
- テストセクションでは実行したコマンドと結果を明示し、必要に応じてログの抜粋を添えてください。
- 変更による影響範囲（破壊的変更の有無、ドキュメント更新の必要性など）を明記してください。

## セキュリティと権限
- データ削除や外部サービスへの書き込みなど破壊的な操作は、事前にレビュー依頼または承認を受けてから実行してください。
- API キーや認証情報は環境変数経由で扱い、ファイルに直接書き込まないでください。
- ネットワークアクセスを伴う作業は、必要性と想定される通信先を事前に共有してください。

## ファイルスコープ
- この AGENTS.md の指示はリポジトリ全体に適用されます。
